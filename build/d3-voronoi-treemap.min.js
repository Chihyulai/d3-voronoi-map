!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-array"),require("d3-polygon"),require("d3-weighted-voronoi")):"function"==typeof define&&define.amd?define(["exports","d3-array","d3-polygon","d3-weighted-voronoi"],t):t(e.d3=e.d3||{},e.d3,e.d3,e.d3)}(this,function(e,t,n,r){"use strict";function o(){function e(e,t){return A(t.x-e.x)+A(t.y-e.y)}function o(e){d(),w=e.length,v=Math.abs(n.polygonArea(q.clip())),m=M*v,C=[];var t=0,r=s(e),o=!1;for(j(r,t);!(o||t>=b);)r=i(r,l(r)),t++,o=f(r),j(r,t);return{polygons:r,iterationCount:t,convergenceRatio:g(r)/v}}function i(e,t){var n;return a(e,t),n=e.map(function(e){return e.site.originalObject}),e=q(n),e.length<w&&console.log("at least 1 site has no area, which is not supposed to arise"),u(e,t),n=e.map(function(e){return e.site.originalObject}),e=q(n),e.length<w&&console.log("at least 1 site has no area, which is not supposed to arise"),e}function a(e,t){var r,o,i,a,u,c,h=[];r=.5*t;for(var g=0;g<w;g++)o=e[g],i=o.site.originalObject,a=n.polygonCentroid(o),u=a[0]-i.x,c=a[1]-i.y,u*=1-r,c*=1-r,i.x+=u,i.y+=c,h.push(i);x(h)}function u(e,t){var r,o,i,a,u,c,h=[];r=.1*t;for(var g=0;g<w;g++)o=e[g],i=o.site.originalObject,a=n.polygonArea(o),u=i.targetedArea/a,u=Math.max(u,.9+r),u=Math.min(u,1.1-r),c=i.weight*u,c=Math.max(c,O),i.weight=c,h.push(i);x(h)}function c(t){var n,r,o,i,a,u,c,h=0;do{n=!1;for(var g=0;g<w;g++){r=t[g];for(var f=g+1;f<w;f++)if(o=t[f],r.weight>o.weight?(i=r,a=o):(i=o,a=r),u=e(r,o),u<i.weight-a.weight){c=u+a.weight/2,c=Math.max(c,O),i.weight=c,n=!0,h++;break}if(n)break}}while(n);h>0&&console.log("# fix: "+h)}function h(t){var n,r,o,i,a,u,c,h=0;do{n=!1;for(var g=0;g<w;g++){r=t[g];for(var f=g+1;f<w;f++)if(o=t[f],r.weight>o.weight?(i=r,a=o):(i=o,a=r),u=e(r,o),u<i.weight-a.weight){c=i.weight-a.weight-u,a.weight+=c+O,n=!0,h++;break}if(n)break}}while(n);h>0&&console.log("# fix: "+h)}function g(e){for(var t,r,o,i=0,a=0;a<w;a++)t=e[a],r=t.site.originalObject,o=n.polygonArea(t),i+=Math.abs(r.targetedArea-o);return i}function f(e){var t=g(e);return C.unshift(t),C.length>V&&C.pop(),console.log("error %: "+Math.round(100*t*1e3/v)/1e3),t<m}function l(e){var t,n,r,o,i=0,a=0,u=3,c=1,h=u;if(C.length<V)return 0;if(g(e)>v/10)return 0;t=C[0],n=C[1],r=t-n>0;for(var f=2;f<C.length-2;f++)t=n,n=C[f],t-n>0!=r&&(i+=h,r=!r),a+=h,h-=c,h<1&&(h=1);return o=i/a,o>0&&console.log("flickering mitigation ratio: "+Math.floor(1e3*o)/1e3),o}function d(){switch(R){case 0:x=c;break;case 1:x=h;break;default:console.log("Variant of 'handleOverweighted' is unknown")}}function s(e){var t,n,r=e.reduce(function(e,t){return Math.max(e,y(t))},-(1/0)),o=r*k;return t=e.map(function(e,t){return{index:t,weight:Math.max(y(e),o),originalData:e}}),n=p(t),q(n)}function p(e){var r,o,i=e.reduce(function(e,t){return e+=t.weight},0),a=v/w,u=t.extent(q.clip().map(function(e){return e[0]})),c=t.extent(q.clip().map(function(e){return e[1]})),h=u[1]-u[0],g=c[1]-c[0],f=a/2;return e.map(function(e){for(r=u[0]+h*Math.random(),o=c[0]+g*Math.random();!n.polygonContains(q.clip(),[r,o]);)r=u[0]+h*Math.random(),o=c[0]+g*Math.random();return{index:e.index,targetedArea:v*e.weight/i,data:e,x:r,y:o,weight:f}})}var w,v,m,x,y=function(e){return e.weight},M=.01,b=50,k=.01,j=function(e,t){return!0},O=1,A=(Math.sqrt,function(e){return Math.pow(e,2)}),q=r.weightedVoronoi(),C=[],R=1,V=10;return o.weight=function(e){return arguments.length?(y=e,o):y},o.convergenceRatio=function(e){return arguments.length?(M=e,o):M},o.maxIterationCount=function(e){return arguments.length?(b=e,o):b},o.minWeightRatio=function(e){return arguments.length?(k=e,o):k},o.tick=function(e){return arguments.length?(j=e,o):j},o.clip=function(e){return arguments.length?(q.clip(e),o):q.clip()},o}e.voronoiTreemap=o,Object.defineProperty(e,"__esModule",{value:!0})});